<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery with Sidebar and Ratings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
       /* Main layout and styles */
       :root {
        --tran: all 0.5s ease 0s;
        --dark: #1c2429;
        --back: #1d659f;
        --bg-light: #e2e2e2;
    }
    
    * { outline: none; }
    
    body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        background: var(--bg-light);
    }
    
    .area {
        float: left;
        background: var(--bg-light);
        width: 100%;
        height: 100%;
        padding-left: 60px;
    }
    #filter-form label {
        display: inline-block;
        margin-right: 30px; /* 각 체크박스 사이의 간격 조정 */
    }
    
    /* Sidebar styles */
    .fa-2x {
        font-size: 2em;
        }
        .fa {
        position: relative;
        display: table-cell;
        width: 60px;
        height: 36px;
        text-align: center;
        vertical-align: middle;
        font-size:20px;
        }
        
        
        .main-menu:hover,nav.main-menu.expanded {
        width:250px;
        overflow:visible;
        }
        
        .main-menu {
        background:#ffcc00;
        border-right:1px solid #e5e5e5;
        position:absolute;
        top:0;
        bottom:0;
        height:100%;
        left:0;
        width:60px;
        overflow:hidden;
        -webkit-transition:width .05s linear;
        transition:width .05s linear;
        -webkit-transform:translateZ(0) scale(1,1);
        z-index:1000;
        }
        
        .main-menu>ul {
        margin:7px 0;
        }
        
        .main-menu li {
        position:relative;
        display:block;
        width:250px;
        }
        
        .main-menu li>a {
        position:relative;
        display:table;
        border-collapse:collapse;
        border-spacing:0;
        color:#999;
         font-family: arial;
        font-size: 14px;
        text-decoration:none;
        -webkit-transform:translateZ(0) scale(1,1);
        -webkit-transition:all .1s linear;
        transition:all .1s linear;
          
        }
        
        .main-menu .nav-icon {
        position:relative;
        display:table-cell;
        width:60px;
        height:36px;
        text-align:center;
        vertical-align:middle;
        font-size:18px;
        }
        
        .main-menu .nav-text {
        position:relative;
        display:table-cell;
        vertical-align:middle;
        width:190px;
          font-family: 'Titillium Web', sans-serif;
        }
        
        .main-menu>ul.logout {
        position:absolute;
        left:0;
        bottom:0;
        }
        
        .no-touch .scrollable.hover {
        overflow-y:hidden;
        }
        
        .no-touch .scrollable.hover:hover {
        overflow-y:auto;
        overflow:visible;
        }
        
        a:hover,a:focus {
        text-decoration:none;
        }
        
        nav {
        -webkit-user-select:none;
        -moz-user-select:none;
        -ms-user-select:none;
        -o-user-select:none;
        user-select:none;
        }
        
        nav ul,nav li {
        outline:0;
        margin:0;
        padding:0;
        }
        .main-menu li:hover>a,nav.main-menu li.active>a,.dropdown-menu>li>a:hover,.dropdown-menu>li>a:focus,.dropdown-menu>.active>a,.dropdown-menu>.active>a:hover,.dropdown-menu>.active>a:focus,.no-touch .dashboard-page nav.dashboard-menu ul li:hover a,.dashboard-page nav.dashboard-menu ul li.active a {
        color:#000000;
        background-color:#fefbd5;
        }
        .area {
        float: left;
        background: #e2e2e2;
        width: 100%;
        height: 100%;
        }
    
    /* Form and image styles */
    #filter-form {
        margin: 20px 0;
    }
    #upload-section {
        margin: 20px 0;
    }
    #images-section {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    #images-section article {
        background: white;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    #images-section img {
        max-width: 100%;
        height: auto;
    }
    .star-rating {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .stars label {
        cursor: pointer;
    }
    
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="main-menu">
        <ul>
            <li class="has-subnav">
                <a href="/">
                    <i class="fa fa-2x">MENU</i>
                    <span class="nav-text">
                        홈
                    </span>
                </a>
            </li>
            <li class="has-subnav">
                <a href="community.html">
                    <i class="fa  fa-2x"></i>
                    <span class="nav-text">
                        커뮤니티
                    </span>
                </a>
            </li>
            </li>
            <li class="has-subnav">
                <a href="profile.html">
                    <i class="fa  fa-2x"></i>
                    <span class="nav-text">
                        프로필
                    </span>
                </a>
            </li>
            <li class="has-subnav">
                <a href="community.html">
                    <i class="fa  fa-2x"></i>
                    <span class="nav-text">
                        자랑게시판
                    </span>
                </a>
            </li>
            <li class="has-subnav">
                <a href="mypage.html">
                    <i class="fa  fa-2x"></i>
                    <span class="nav-text">
                        마이페이지
                    </span>
                </a>
            </li>
        </ul>
    </nav>
    
    <!-- Main Area -->
    <div class="area">
        <form id="filter-form">
            <label><input type="checkbox" name="category" value="interior"> Interior</label>
            <label><input type="checkbox" name="category" value="exterior"> Exterior</label>
        </form>
        <section id="upload-section">
            <form id="upload-form" enctype="multipart/form-data">
                <label>Title: <input type="text" name="title" required></label>
                <label>Category:
                    <select name="category" required>
                        <option value="interior">Interior</option>
                        <option value="exterior">Exterior</option>
                    </select>
                </label>
                <input type="file" name="image" accept="image/*" required>
                <button type="submit">Upload Image</button>
            </form>
        </section>
        <section id="images-section"></section>
    </div>
    
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadForm = document.getElementById('upload-form');
            const imagesSection = document.getElementById('images-section');
            const filterForm = document.getElementById('filter-form');
            
            uploadForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                
                const formData = new FormData(uploadForm);
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Image uploaded successfully!');
                    fetchImages();
                } else {
                    alert('Failed to upload image');
                }
            });
            
            const fetchImages = async () => {
                const response = await fetch('/images');
                const images = await response.json();
                displayImages(images);
            };
            
            const displayImages = (images) => {
                imagesSection.innerHTML = '';
                images.forEach(image => {
                    const article = document.createElement('article');
                    article.innerHTML = `
                        <img src="${image.image_url}" alt="${image.title}">
                        <h3>${image.title}</h3>
                        <p>Category: ${image.category}</p>
                        <div class="star-rating">
                            <div class="stars">
                                ${[...Array(5)].map((_, i) => `
                                    <label>
                                        <input type="radio" name="rating${image.id}" value="${i + 1}" ${image.rating === i + 1 ? 'checked' : ''}>
                                        <span class="fa fa-star${i + 1 <= image.rating ? ' checked' : ''}"></span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    imagesSection.appendChild(article);
                    
                    article.querySelectorAll('.stars input').forEach(input => {
                        input.addEventListener('change', async () => {
                            const response = await fetch('/rate', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    imageId: image.id,
                                    rating: input.value
                                })
                            });
                            if (response.ok) {
                                fetchImages();
                            } else {
                                alert('Failed to update rating');
                            }
                        });
                    });
                });
            };
            
            filterForm.addEventListener('change', () => {
                fetchImages();
            });
            
            fetchImages();
        });
    </script>
</body>
</html>

